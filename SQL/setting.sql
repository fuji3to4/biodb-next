-- PostgreSQL 演習用スクリプト
-- データベースを毎回クリーンに作り直すスクリプト
-- 実行例: psql -U user -d postgres -f setting.sql

-- 既存のデータベースを削除して作り直し
DROP DATABASE IF EXISTS database1;
CREATE DATABASE database1 OWNER "user";

-- database1に接続
\connect database1


-- テーブル作成
CREATE TABLE "業者" (
	"業者コード" CHAR(4) PRIMARY KEY,
	"業者名" CHAR(20),
	"業者住所" CHAR(40)
);

CREATE TABLE "商品" (
	"商品コード" CHAR(4) PRIMARY KEY,
	"商品種類" CHAR(20),
	"商品名" CHAR(30),
	"販売価格" INTEGER
);

CREATE TABLE "発注" (
	"注文コード" INTEGER PRIMARY KEY,
	"商品コード" CHAR(4) NOT NULL,
	"業者コード" CHAR(4) NOT NULL,
	"数量" INTEGER,
	"発注日" DATE
);

CREATE TABLE "納入" (
	"注文コード" INTEGER PRIMARY KEY,
	"商品コード" CHAR(4) NOT NULL,
	"業者コード" CHAR(4) NOT NULL,
	"数量" INTEGER,
	"納入日" DATE
);

-- 参照整合性（外部キー）
ALTER TABLE "発注"
	ADD CONSTRAINT "fk_発注_商品" FOREIGN KEY ("商品コード") REFERENCES "商品"("商品コード"),
	ADD CONSTRAINT "fk_発注_業者" FOREIGN KEY ("業者コード") REFERENCES "業者"("業者コード");

ALTER TABLE "納入"
	ADD CONSTRAINT "fk_納入_商品" FOREIGN KEY ("商品コード") REFERENCES "商品"("商品コード"),
	ADD CONSTRAINT "fk_納入_業者" FOREIGN KEY ("業者コード") REFERENCES "業者"("業者コード");

-- データ投入
INSERT INTO "業者" ("業者コード","業者名","業者住所") VALUES
('9876','田中商事','東京都港区'),
('1111','井上卸','川崎市川崎区'),
('7777','伊藤商店','神戸市灘区'),
('9641','山田産業','大阪市中央区'),
('6767','鈴木販売','名古屋市北区'),
('2222','佐藤物産','横浜市西区'),
('3333','高橋貿易','福岡市博多区'),
('5555','渡辺商会','札幌市中央区');

INSERT INTO "商品" ("商品コード","商品種類","商品名","販売価格") VALUES 
('1233','食料品','食パン',200),
('1234','日用品','セッケン',180),
('1235','日用品','歯ブラシ',15),
('1111','食料品','牛乳',250),
('2222','日用品','シャンプー',580),
('3333','オフィス用品','机',15000),
('4444','野菜','トマト',180),
('3456','オフィス用品','イス',9000),
('1357','冷凍食品','冷凍コロッケ',300),
('2468','野菜','キャベツ',99);

INSERT INTO "発注" ("注文コード","商品コード","業者コード","数量","発注日") VALUES 
(3,'1233','9876',10,'2025-09-01'),
(8,'1111','2222',15,'2025-09-15'),
(9,'2222','7777',25,'2025-10-01'),
(10,'3333','5555',5,'2025-11-10'),
(11,'4444','1111',100,'2025-12-01'),
(2,'1234','9876',20,'2025-08-10'),
(6,'1235','9641',40,'2025-10-25'),
(4,'2468','9641',200,'2025-09-01'),
(7,'2468','9641',30,'2025-11-02');

INSERT INTO "納入" ("注文コード","商品コード","業者コード","数量","納入日") VALUES 
(1,'2468','9876',30,'2025-09-01'),
(8,'1111','2222',15,'2025-09-20'),
(9,'2222','7777',25,'2025-10-05'),
(10,'3333','5555',5,'2025-11-15'),
(11,'4444','1111',80,'2025-12-05'),
(0,'1357','9876',50,'2025-08-22'),
(5,'1234','9641',10,'2025-10-12'),
(3,'1233','9876',10,'2025-09-10');